<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Per Te - Il Nostro Tempo</title>
    <!-- Font per la seconda parte e icone -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <style>
        /* RESET E BASE */
        html, body {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            background-color: #000000;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #fff;
        }

        /* SFONDO STELLATO UNIVERSALE */
        #starfield {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }

        /* --- STILE BOTTONI MENU (GRANDI E CENTRATI) --- */
        #finalButtonsContainer {
            display: none;
            position: absolute; top: 75%; left: 50%;
            transform: translate(-50%, -50%);
            flex-direction: column; gap: 20px;
            align-items: center; z-index: 10;
        }

        .menu-btn {
            background: rgba(255, 182, 193, 0.15);
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 18px 45px;
            font-size: 16px;
            min-width: 260px;
            border-radius: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .menu-btn:hover {
            background: rgba(255, 182, 193, 0.25);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(255, 77, 109, 0.2);
            border-color: rgba(255, 182, 193, 0.5);
            color: #fff;
        }

        /* BOTTONI SALTA PICCOLI */
        .skip-btn {
            position: fixed; bottom: 20px; right: 20px;
            z-index: 100;
            background: rgba(255, 182, 193, 0.1);
            color: rgba(255, 255, 255, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            font-size: 10px;
            border-radius: 20px;
            cursor: pointer;
            text-transform: uppercase;
        }

        /* --- VISTA 1: INTRO --- */
        #intro-view {
            position: relative; z-index: 2;
            width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
        }

        /* --- VISTA 2: CRONOMETRO (IDENTICO AL TUO FILE) --- */
        #clock-view {
            display: none;
            position: relative; z-index: 3;
            width: 100%; height: 100%;
            justify-content: center; align-items: center;
        }

        #heartWrapper {
            position: relative;
            width: 100vw; height: 100vw;
            max-width: 550px; max-height: 550px;
        }

        #garden { width: 100%; height: 100%; }

        #elapseClock {
            position: absolute; top: 46%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center; width: 100%;
            pointer-events: none; z-index: 10;
            text-shadow: 0 0 20px rgba(0,0,0,1), 0 0 10px rgba(0,0,0,1);
            display: flex; flex-direction: column; gap: 5px;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .days { font-size: 2.5rem; color: #ff4d6d; font-weight: bold; }
        .time-box { font-size: 1.1rem; color: #eee; letter-spacing: 2px; }

        #backBtn {
            position: fixed; top: 15px; left: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ccc; padding: 8px 12px;
            border-radius: 20px; text-decoration: none;
            font-size: 12px; z-index: 100;
        }

        /* --- VISTA 3: LOGIN --- */
        #login-view {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); /* Pi√π scuro per pulizia */
            z-index: 1000; justify-content: center; align-items: center;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            padding: 40px; border-radius: 25px;
            border: 1px solid rgba(255, 182, 193, 0.3);
            text-align: center; width: 85%; max-width: 350px;
        }

        .login-card h3 { font-family: 'Playfair Display', serif; color: #ffb3c1; margin-bottom: 25px; letter-spacing: 2px; }
        .password-container { position: relative; margin-bottom: 20px; }
        .password-container input {
            width: 100%; padding: 12px; background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,182,193,0.3); border-radius: 10px;
            color: #fff; font-size: 1rem; outline: none; box-sizing: border-box;
        }
        .toggle-password { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #666; }

        /* --- VISTA 4: SORPRESA FINALE --- */
        #surprise-view {
            display: none; position: relative; z-index: 2000;
            width: 100%; height: 100%;
        }

        /* MOBILE OPTIMIZATION */
        @media (max-width: 600px) {
            #elapseClock { top: 50%; }
            .days { font-size: 1.8rem; }
            .time-box { display: flex; flex-direction: column; gap: 8px; font-size: 0.9rem; }
            .menu-btn { min-width: 220px; padding: 15px 30px; font-size: 14px; }
        }
    </style>
</head>
<body>

    <canvas id="starfield"></canvas>

    <!-- 1. INTRO NARRATIVA -->
    <div id="intro-view">
        <canvas id="intro-canvas"></canvas>
        <div id="finalButtonsContainer">
            <button id="btnClock" class="menu-btn">Il Nostro Tempo</button>
            <button id="btnAndesso" class="menu-btn">E adesso..?</button>
        </div>
        <button id="skipIntro" class="skip-btn">Salta Animazione</button>
    </div>

    <!-- 2. CRONOMETRO (Identico al tuo file) -->
    <div id="clock-view">
        <a href="#" id="backBtn" onclick="location.reload()">‚Üê Torna</a>
        <div id="heartWrapper">
            <canvas id="garden"></canvas>
            <div id="elapseClock"></div>
        </div>
    </div>

    <!-- 3. LOGIN -->
    <div id="login-view">
        <div class="login-card">
            <h3>IDENTIFICATI</h3>
            <div class="password-container">
                <input type="password" id="password" placeholder="Password">
                <i class="toggle-password fas fa-eye" id="eyeIcon" onclick="togglePassword()"></i>
            </div>
            <button class="menu-btn" onclick="checkPassword()" style="min-width: 100%; padding: 12px;">SBLOCCA</button>
            <p id="error-msg" style="color: #ff4d6d; display: none; margin-top: 15px; font-size: 12px;">Password errata</p>
        </div>
    </div>

    <!-- 4. SORPRESA NARRATIVA -->
    <div id="surprise-view">
        <canvas id="surprise-canvas"></canvas>
        <button id="skipSurprise" class="skip-btn">Salta Animazione</button>
    </div>

    <script>
        // --- CONFIGURAZIONE GLOBALE ---
        const starCanvas = document.getElementById("starfield");
        const starCtx = starCanvas.getContext("2d");
        const introCanvas = document.getElementById("intro-canvas");
        const introCtx = introCanvas.getContext("2d");
        const surpriseCanvas = document.getElementById("surprise-canvas");
        const surpriseCtx = surpriseCanvas.getContext("2d");
        const gardenCanvas = document.getElementById("garden");
        const gardenCtx = gardenCanvas.getContext("2d");

        let width, height, stars = [];
        let msgIndex1 = 0, opacity1 = 0, fState1 = 'in', wait1 = 0;
        let msgIndex2 = 0, opacity2 = 0, fState2 = 'in', wait2 = 0;

        const messages1 = [
            { text: "Amore, stavo pensando a una cosa...", duration: 150 },
            { text: "L‚Äôuniverso esiste da circa 13,8 miliardi di anni e ci sono pi√π stelle nel cielo che granelli di sabbia su tutte le spiagge della Terra.", duration: 380 },
            { text: "In questo spazio infinito e in un tempo cos√¨ lungo, la probabilit√† che noi due esistessimo nello stesso identico momento era gi√† bassissima.", duration: 380 },
            { text: "Se poi aggiungi che sulla Terra siamo 8 miliardi di persone, divise in migliaia di citt√† e milioni di strade...", duration: 350 },
            { text: "Beh, la probabilit√† statistica che ci incrociassimo proprio quel giorno, a quell‚Äôora, √® praticamente vicina allo zero.", duration: 380 },
            { text: "Siamo un‚Äôanomalia statistica, un 'miracolo' logico tra trilioni di galassie e pianeti deserti.", duration: 350 },
            { text: "√à pazzesco: tra tutto quel vuoto, io sono finito esattamente nello stesso punto della mappa dove c‚Äôeri tu.", duration: 380 },
            { text: "Ma la statistica pi√π difficile non √® incontrarsi, √® restare.", duration: 250 },
            { text: "Superare i 1000 giorni insieme alla nostra et√†, mentre tutto intorno corre veloce, non √® da tutti.", duration: 350 },
            { text: "I numeri dicono che siamo un‚Äôeccezione, un caso su un milione che ha funzionato davvero.", duration: 350 },
            { text: "E dopo questi 3 anni, la verit√† √® che non mi interessa quanto fosse bassa la probabilit√† di trovarti...", duration: 350 },
            { text: "Mi interessa solo che √® successo.", duration: 250 },
            { text: "Ti amo pi√π di quanto l‚Äôuniverso possa contenere.\nBuon anniversario a noi ‚ù§Ô∏è‚Äçü©π", duration: 999999 }
        ];

        const messages2 = [
            "Davvero non ti basta amore?",
            "E allora lascia che ti sorprenda ancora‚Ä¶üíù",
            "Questa notteüåô la immagino lenta, intima...",
            "fatta di sguardiüëÄ che si fermano\nun po‚Äô pi√π a lungo del solito.",
            "Un calice di vinoüç∑ tra le mani...",
            "i nostri pensieriüí≠ pi√π segreti che trovano\nil coraggio di uscire, uno alla volta.",
            "Il letto coperto di petali rossiüåπ, la luce calda...",
            "e noi dueüë• tra le coperte,",
            "avvolti in abbracciü´Ç che sanno di desiderio\ne di casa allo stesso tempo.",
            "Mi piace l‚Äôidea di sentirti addosso‚ú®,\npelle contro pelle, distesi,",
            "lasciando che le carezze parlinoüó£Ô∏è al posto nostro...",
            "che i baci diventino pi√π lenti, \npi√π passionali.üå∂Ô∏è",
            "E se a un certo punto dovesse arrivare anche la fame‚Ä¶üçï",
            "beh, ho portato qualcosina..ü•°",
            "ma ho dimenticato piatti e posate.üç¥",
            "Forse perch√© ci sono modi pi√π dolciüç™\ne pi√π audaci di assaporarsi,",
            "scoprendosi piano...ü§∑üèª‚Äç‚ôÇÔ∏è",
            "lasciando che ogni gesto lasci\nun piccolo segno‚úèÔ∏è sulla pelle.",
            "Buon San Valentino\ne Anniversario amore mio‚ù§Ô∏è‚Äçü©π"
        ];

        function resize() {
            width = window.innerWidth; height = window.innerHeight;
            starCanvas.width = width; starCanvas.height = height;
            introCanvas.width = width; introCanvas.height = height;
            surpriseCanvas.width = width; surpriseCanvas.height = height;
            stars = [];
            for (let i = 0; i < 400; i++) {
                stars.push({
                    x: Math.random() * width, y: Math.random() * height,
                    radius: Math.random() * 1.1, opacity: Math.random(),
                    blink: Math.random() * 0.015
                });
            }
        }

        function drawStarfield() {
            starCtx.fillStyle = "#000"; starCtx.fillRect(0, 0, width, height);
            stars.forEach(s => {
                starCtx.globalAlpha = s.opacity;
                starCtx.beginPath(); starCtx.arc(s.x, s.y, s.radius, 0, Math.PI * 2);
                starCtx.fillStyle = "#fff"; starCtx.fill();
                s.opacity += s.blink;
                if (s.opacity > 1 || s.opacity < 0) s.blink = -s.blink;
            });
            starCtx.globalAlpha = 1;
            requestAnimationFrame(drawStarfield);
        }

        function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
            const sections = text.split('\n');
            let allLines = [];
            sections.forEach(section => {
                const words = section.split(' ');
                let line = '';
                for (let n = 0; n < words.length; n++) {
                    let testLine = line + words[n] + ' ';
                    if (ctx.measureText(testLine).width > maxWidth && n > 0) {
                        allLines.push(line); line = words[n] + ' ';
                    } else line = testLine;
                }
                allLines.push(line);
            });
            const startY = y - ((allLines.length * lineHeight) / 2);
            allLines.forEach((l, i) => ctx.fillText(l, x, startY + (i * lineHeight)));
        }

        function loopIntro1() {
            if (document.getElementById("intro-view").style.display === "none") return;
            introCtx.clearRect(0, 0, width, height);
            let fontSize = width < 600 ? 19 : 26;
            introCtx.font = `500 ${fontSize}px 'Segoe UI', sans-serif`;
            introCtx.textAlign = "center";
            introCtx.shadowBlur = 12; introCtx.shadowColor = "rgba(255, 77, 109, 0.6)";

            const m = messages1[msgIndex1];
            if (fState1 === 'in') {
                opacity1 += 0.01; if (opacity1 >= 1) { opacity1 = 1; fState1 = 'wait'; 
                if (msgIndex1 === messages1.length - 1) document.getElementById("finalButtonsContainer").style.display = "flex"; }
            } else if (fState1 === 'wait') {
                wait1++; if (wait1 >= m.duration && msgIndex1 < messages1.length - 1) fState1 = 'out';
            } else if (fState1 === 'out') {
                opacity1 -= 0.015; if (opacity1 <= 0) { opacity1 = 0; msgIndex1++; wait1 = 0; fState1 = 'in'; }
            }
            introCtx.fillStyle = `rgba(255, 210, 220, ${opacity1})`;
            wrapText(introCtx, m.text, width/2, height/2, width*0.85, fontSize + 15);
            requestAnimationFrame(loopIntro1);
        }

        function loopIntro2() {
            if (document.getElementById("surprise-view").style.display === "none") return;
            surpriseCtx.clearRect(0, 0, width, height);
            let fontSize = width < 600 ? 19 : 26;
            surpriseCtx.font = `500 ${fontSize}px 'Poppins', sans-serif`;
            surpriseCtx.textAlign = "center";

            const txt = messages2[msgIndex2];
            let dynamicWait = Math.max(200, txt.length * 9);

            if (fState2 === 'in') {
                opacity2 += 0.008; if (opacity2 >= 1) { opacity2 = 1; fState2 = 'wait'; }
            } else if (fState2 === 'wait') {
                wait2++; if (wait2 >= dynamicWait && msgIndex2 < messages2.length - 1) fState2 = 'out';
            } else if (fState2 === 'out') {
                opacity2 -= 0.01; if (opacity2 <= 0) { opacity2 = 0; msgIndex2++; wait2 = 0; fState2 = 'in'; }
            }
            surpriseCtx.fillStyle = `rgba(255, 210, 220, ${opacity2})`;
            wrapText(surpriseCtx, txt, width/2, height/2, width*0.85, fontSize + 15);
            requestAnimationFrame(loopIntro2);
        }

        // --- AZIONI ---
        document.getElementById("btnClock").onclick = () => {
            document.getElementById("intro-view").style.display = "none";
            document.getElementById("clock-view").style.display = "flex";
            initGarden(); updateClock(); setInterval(updateClock, 1000);
        };

        document.getElementById("btnAndesso").onclick = () => {
            document.getElementById("finalButtonsContainer").style.display = "none";
            document.getElementById("skipIntro").style.display = "none";
            document.getElementById("login-view").style.display = "flex";
        };

        function togglePassword() {
            const inp = document.getElementById("password");
            const icon = document.getElementById("eyeIcon");
            inp.type = inp.type === "password" ? "text" : "password";
            icon.classList.toggle("fa-eye"); icon.classList.toggle("fa-eye-slash");
        }

        function checkPassword() {
            if (document.getElementById("password").value.toLowerCase() === "moglie") {
                document.getElementById("login-view").style.display = "none";
                document.getElementById("intro-view").style.display = "none";
                document.getElementById("surprise-view").style.display = "block";
                loopIntro2();
            } else {
                document.getElementById("error-msg").style.display = "block";
                setTimeout(()=> document.getElementById("error-msg").style.display = "none", 2000);
            }
        }

        document.getElementById("skipIntro").onclick = () => {
            msgIndex1 = messages1.length - 1; fState1 = 'in'; opacity1 = 1;
            document.getElementById("finalButtonsContainer").style.display = "flex";
            document.getElementById("skipIntro").style.display = "none";
        };

        document.getElementById("skipSurprise").onclick = () => {
            msgIndex2 = messages2.length - 1; fState2 = 'in'; opacity2 = 1;
            document.getElementById("skipSurprise").style.display = "none";
        };

        // --- LOGICA CUORE (GARDEN) ---
        function Vector(x, y) { this.x = x; this.y = y; }
        Vector.prototype = {
            rotate: function (theta) {
                var x = this.x, y = this.y;
                this.x = Math.cos(theta) * x - Math.sin(theta) * y;
                this.y = Math.sin(theta) * x + Math.cos(theta) * y; return this;
            },
            mult: function (f) { this.x *= f; this.y *= f; return this; },
            clone: function () { return new Vector(this.x, this.y); }
        };
        function Petal(stretchA, stretchB, startAngle, angle, growFactor, bloom) {
            this.stretchA = stretchA; this.stretchB = stretchB; this.startAngle = startAngle;
            this.angle = angle; this.bloom = bloom; this.growFactor = growFactor; this.r = 1;
        }
        Petal.prototype.render = function () {
            var ctx = this.bloom.garden.ctx;
            var v1 = new Vector(0, this.r).rotate(this.startAngle * Math.PI / 180);
            var v2 = v1.clone().rotate(this.angle * Math.PI / 180);
            var v3 = v1.clone().mult(this.stretchA); var v4 = v2.clone().mult(this.stretchB);
            ctx.strokeStyle = this.bloom.c; ctx.beginPath(); ctx.moveTo(v1.x, v1.y);
            ctx.bezierCurveTo(v3.x, v3.y, v4.x, v4.y, v2.x, v2.y); ctx.stroke();
        };
        function Bloom(p, r, c, pc, garden) {
            this.p = p; this.r = r; this.c = c; this.pc = pc; this.petals = []; this.garden = garden;
            var angle = 360 / pc;
            for (var i = 0; i < pc; i++) this.petals.push(new Petal(Math.random()*2+1, Math.random()*2+1, i*angle, angle, Math.random()*0.8+0.2, this));
        }
        Bloom.prototype.draw = function () {
            this.garden.ctx.save(); this.garden.ctx.translate(this.p.x, this.p.y);
            for (var i = 0; i < this.petals.length; i++) {
                var p = this.petals[i]; if (p.r < this.r) p.r += p.growFactor; p.render();
            }
            this.garden.ctx.restore();
        };
        function Garden(ctx, element) { this.blooms = []; this.ctx = ctx; this.element = element; }
        Garden.prototype.render = function () { for (var i = 0; i < this.blooms.length; i++) this.blooms[i].draw(); };

        function initGarden() {
            const size = Math.min(window.innerWidth * 0.9, 550);
            gardenCanvas.width = size; gardenCanvas.height = size;
            gardenCtx.globalCompositeOperation = "lighter";
            let g = new Garden(gardenCtx, gardenCanvas);
            let offsetX = size / 2, offsetY = size / 2 - (size * 0.08), angle = 10, heartScale = size / 38;
            setInterval(() => { g.render(); }, 35);
            let timer = setInterval(() => {
                let t = angle / Math.PI;
                let x = 16 * Math.pow(Math.sin(t), 3) * heartScale;
                let y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t)) * heartScale;
                g.blooms.push(new Bloom(new Vector(offsetX + x, offsetY + y), size / 45, `rgba(255, ${Math.random()*100+100}, ${Math.random()*100+150}, 0.25)`, 8, g));
                if (angle >= 30) clearInterval(timer); angle += 0.18;
            }, 50);
        }

        function updateClock() {
            const start = new Date(2023, 1, 11, 0, 0, 0); 
            const now = new Date();
            const diff = now - start;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const mins = Math.floor((diff / (1000 * 60)) % 60);
            const secs = Math.floor((diff / 1000) % 60);
            document.getElementById("elapseClock").innerHTML = 
                `<div class="days">${days} GIORNI</div>` +
                `<div class="time-box"><span>${hours} ORE, ${mins} MIN, </span><span>${secs} SEC</span></div>`;
        }

        window.onload = () => { resize(); drawStarfield(); loopIntro1(); };
        window.onresize = resize;
    </script>
</body>
</html>
